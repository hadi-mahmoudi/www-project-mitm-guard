# What is MITM GUARD?
### ARP Protocol
ARP or Address Resolution Protocol is a protocol used both in the old OSI model and now in the TCP/IP model to convert IP address to MAC address. ARP works in OSI between layers 2 and 3 and in TCP/IP in layer 2.
A simple explanation of the ARP protocol is that when two systems communicate via TCP/IP, they need each other's MAC address in addition to the IP address. For this purpose, each of the hosts that is the source of the connection sends an ARP Request to receive the destination MAC address. The ARP Request, in a nutshell, sends the question of "Who this IP is?" via broadcast through switch to all hosts on the LAN. The host that owns the IP address, responds to the ARP Request through the unicast massage to the source host and sends its MAC address. The source host stores the received information in a table called ARP-Cache. All hosts in the network store the ARP-Cache so that in later communications they can communicate faster without going through the previous steps.
### Problem
the ARP protocol, ARP uses TCP/IP and is part of it, suffers from a very troublesome security vulnerability that causes different attacks within the network. The problem with the ARP protocol is that it accepts any system with any IP-MAC address it claims without going through any authentication. Then stores the latest replay in the ARP-Cache table even if there is no ARP request for that. In this way, the last reply (IP-MAC) in the ARP-Cache of the victim system is replaced. Therefore, hackers can impersonate IP-MACs on one side of the router and on the other side of the systems inside the network (ARP-poisoning) and eavesdrop on intermediate traffic. This type of attack is called Man in the middle (MITM), in which the IP-MAC forgery process is called ARP Poisoning. Other attacks caused by this security vulnerability in ARP include: MAC address spoofing, session hijacking, MAC duplicating, MAC flooding and DOS attack.
The tool introduced under the name of "MITM GUARD", has been designed and implemented with the aim of detecting and dealing with security problems caused by ARP protocol in internal networks
# Install MITM GUARD
### Problem
The proposed tool can be installed and implemented in two forms, single agent and multi agent, which is completely decentralized. however The capabilities of the above tools to detect and prevent MITM attacks in the implementation of the multi-agent method are far greater than the single agent method. the decentralized-based method has some advantages over others such as the computational and traffic load distribution and timely reaction without dependence on the central system. The decentralized-based method also has disadvantages that we have explored here in the context of the various challenges that exist in this method. The first challenge is that in the decentralized-based method, the decentralized structure and continuous communication of nodes with each other create other challenges in the discussion of exchanged traffic. The most important point here is that the principle of network availability and agents are installed continuously. Minimizing the extra traffic load generated by the installed agents and constantly checking the communication between the nodes and between the agents is one of the main challenges to be considered. The second challenge arises due to the independence of the agents in the decentralized structure and in the attack detection process. Here, too, it should be noted that the principle of Integrity is observed in agents, because ARP-spoofing may have been performed on hosts before installing agents, and ARP-Cache may have been poisoned, and the detection system in agents may also be poisoned. The third challenge arises when agents detect an attack and try to prevent it from continuing and identify the attacking system. Here it is important to consider more professional attack scenarios than the original methods because in newer ARP poisoning attacks hackers try to leave the least footprints. As a result, existing agents must be able to find the characteristics of the hacker system in different scenarios. The fourth challenge with decentralized methods is the proposed solution to prevent ARP attacks. Here the existing solution must have sufficient
### Technical Requirements
#### Recommended Hardware Requirements 
For an optimal experience with hands-on labs and other practical activities, we     recommend the following configuration: 
 -	Processor: Dual Core 1.8Ghz (64-bit) or better configuration 
 -	Memory: 4GB or more 
 -	Storage: 2GB or more
#### Software Requirements  
 -	Operating system: Linux 
 -	Python 3.8.x or 3.9.x (NOT 3.7, ..)
### Install Steps
#### Supported OS
-	Linux (Debian/Redhat)
#### Single Agent

```bash
apt install python3
pip install -r requirements.txt
git clone https://github.com/OWASP/mitm_guard.git
cd mitm_guard/
pyhton3 main_proc.py -e help
```

#### Multi Agent

```bash
apt install python3
pip install -r requirements.txt
git clone https://github.com/OWASP/mitm_guard.git
cd mitm_guard/
pyhton3 main_proc.py -e help
```

# Main features
-	Realtime Detection and Prevention
-	Decentralization
-	Minimize the traffic load of communication between agents in the network
-	Fully detection of attackers using various operational processes
-	Agents cooperate with neighbor ones to detect the attackers in specific situations
-	Multi-threaded
# Different condition for detection and prevention
### Priority One
#### One Condition
In the first scenario, the hacker scans the victim's system for information before attacking the node. As shown in Table.1, for this reason, in the same New-ARP, there is also a hacker profile (IP, MAC) so that there are 2 different IP addresses for the forged MAC. In this case, it is enough for the MAC to search the system identified as the victim in the same New-ARP list and find the IP associated with it (except for the IP found for the victim node). In this step, our proposed tool identifies the victim system, the type of attack and the hacker profile and sends this information to both the node and other agents within the network for further prevention.
#### Two Condition
As shown in Table.2, the second attack scenario occurs when the attacker leaves no trace of himself in New-ARP and only attempts to forge and thus change the MAC on the victim node in the New-ARP system. At this stage, our proposed tool uses two different methods to identify the hacker profile. In the first method, the agent in question propagates the forged MAC to all other agents in the network and requests that if there is an IP address associated with that MAC address, it be sent in response to the agent in question. The second method is used when no response is received from the agents, in which case the agent activates procedure_net_scan. This procedure uses network scanning to identify the forged MAC IP. This scenario occurs when the hacker did not scan the network at all but was present in the network and is still connected to the network.
### Priority Two
After reviewing the priority 1, if there are no changes in the CN after checking, this time the Agent will check the normal hosts in the network to detect any MAC forgery or MITM attack. At this point, the Agent detects a MAC address in the New-ARP list that has 2 different IPs. As shown in Table.3, identifying such a MAC address indicates that one of the available IP addresses is the hacker IP. To find out which hacker and which IP is the victim, the Agent sends an ARP Request and compares the target MAC to find out which IPs are real and which are related to the hacker. After identifying the information about the hacker and the victim system, this information is published among all internal agents to perform the next steps, prevention. In the third stage, Prevention, after detecting the agent attack, the IP-MAC router address and the IP-MAC hacker address are set statically at variable time intervals (first 10 minutes, second time 30 minutes, third time 2 days) by the admin the network is configured, it does. It then releases the IP-MAC Attacker to all neighboring agents so that they can continue to set the static IP-MAC router and hacker addresses. This prevents the hacker from launching an attack on the network within the initial set time. If the time of static IP-MAC address of the hacker and router expires and the hacker attacks again, this time will increase.
# Roadmap
The highest priorities will be as the following From February 2021 to the next 6 months:
-	Compatible with Windows OS
-	User Interface
-	Improving source code 
# Licensing

MIT License

Copyright (c) 2021 OWASP

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

# links
### [OWASP](https://owasp.org/www-project-mitm-guard/)
### [DOWNLOAD](https://github.com/OWASP/mitm_guard/)
### [Wiki](https://github.com/OWASP/mitm_guard/wiki)
